# Business Requirements Document — Multi-Vendor Airtable-Like App
Date: 2025-12-12

## 1. Product Summary & Objectives
- Multi-tenant, Airtable-style app where each company manages its own databases, tables, views, permissions, and workflows.
- Goals: fast onboarding (guest → company admin), granular access (row/column/view with roles & groups), reliable workflows via Temporal, safe public sharing of views.
- Tech stack: Postgres, Nuxt 4 (frontend + server), Temporal for workflows, MinIO for file storage, username/password auth.

## 2. Scope (MVP) vs. Out of Scope
- In scope: company creation by guest; admin invites; database/table/column CRUD; supported column types (basic + advanced); views (table, grouped, kanban, gantt, calendar, dashboard); row conditions; column permissions (masked/hide/readonly); view access; public links; workflows on record create/update/delete with conditions; soft delete.
- Out of scope (MVP): SSO; pricing/billing; mobile apps; offline mode; full-text search; advanced rate limiting.

## 3. Personas & Roles
- Guest: can create a company and becomes its admin.
- Company Admin: manages company roles/groups, users, databases, tables, columns, views, permissions, workflows, and shares.
- Database Member: invited to specific databases; permissions governed by row/column/view rules plus role/group membership.
- View Collaborator: explicitly granted access to a view.
- Public Viewer: read-only via public link; still subject to row/column visibility rules.
- Roles & Groups: company-level role structure is admin-defined; users may belong to multiple roles and groups; grants can target roles, groups, or users.

## 4. Core User Stories & Flows
- Company creation: guest signs up, creates company, becomes admin.
- Invites: admin invites users; assigns roles/groups; optional direct database/view access.
- Database/table setup: admin creates databases, tables, and columns (allowed types).
- Views: admin creates views (table, grouped, kanban, gantt, calendar, dashboard), configures them, grants access, and may publish public links.
- Permissions: admin defines row conditions and column visibility modes per role/group/user/view; defaults to deny unless granted.
- Workflows: admin defines workflows on CRUD events with optional conditions; multiple workflows per event; executed via Temporal.
- Sharing: public links for views (read-only) with enforced row filters and column visibility.

## 5. Data Model (Conceptual)
- Company(id, name, owner_id, created_at)
- User(id, auth fields, profile)
- Role(id, company_id, name, metadata); UserRole(user_id, role_id)
- Group(id, company_id, name); UserGroup(user_id, group_id)
- Database(id, company_id, name, created_by, created_at, deleted_at)
- Table(id, database_id, name, metadata, created_by, deleted_at)
- Column(id, table_id, name, type, options, constraints)
  - Types: text, number, boolean, date, category, user, file, tag
- View(id, table_id, type, config, sharing_token?, public_enabled?, deleted_at)
- Row/Record(id, table_id, data JSONB, created_by, updated_by, deleted_at)
- ViewAccess(view_id, principal (role/group/user), rights)
- RowRule(id, table_id, condition, principals (roles/groups/users), action=read)
- ColumnRule(id, column_id, scope (role/group/user/view), mode=masked|hide|readonly)
- Workflow(id, table_id, event (create|update|delete), condition, steps/handler ref, enabled)
- FileRef(id, bucket, key, size, mime, checksum, created_by) stored in MinIO

## 6. Permission Model
- Principal resolution: authenticated user → roles → groups → view-level grants.
- Row rules: evaluate conditions on record fields; if matched, allow read for specified principals; default deny.
- Column rules: per column per principal or view; modes: masked (obfuscate), hide (omit), readonly (no updates).
- View access: explicit allow list (roles/groups/users); public links bypass auth but still apply row/column rules.
- Evaluation order: authenticate → resolve principals → apply row filters → apply column rules → apply view config (sort/group/aggregate).

## 7. Views & Sharing
- Supported views: table, grouped table, kanban (category/tag), gantt (start/end dates), calendar (date), dashboard (widgets: counts/charts).
- Public sharing: tokenized link per view; read-only; row filters and column visibility enforced; revocation supported.

## 8. Workflow Events & Triggers (Temporal)
- Events: record create, update, delete.
- Multiple workflows per event; each may have a condition (field/value predicate).
- Execution: app emits event → evaluates condition → enqueues Temporal workflow with payload (record snapshot, diff, user, table/view context, resolved principals).
- Reliability: idempotent workflow IDs per record+event; retries via Temporal; store run logs.

## 9. API & Integration Surfaces (Nuxt Server)
- Auth: username/password; sessions/tokens.
- Company: create company (guest); list users; manage roles/groups; invite users; assign roles/groups.
- Database/table/column: CRUD databases, tables, columns (allowed types).
- Views: CRUD views; manage access; create/revoke public links.
- Records: CRUD with row/column enforcement; soft delete rows.
- Permissions: CRUD row rules, column rules, view access bindings.
- Workflows: CRUD workflow definitions; attach to events; list runs.
- Files: upload/download via MinIO-backed endpoints; columns of type file store FileRef.
- Soft delete: all list endpoints exclude deleted by default; optional flag to include.
- Responses rely on HTTP status codes (no success flag).

## 10. Non-Functional Requirements
- Security: strict tenant scoping by company_id; public links read-only; audit admin actions and workflow runs.
- Performance: target P99 read < 800ms for typical view/table queries; writes < 1.2s including workflow enqueue; paginate lists.
- Availability: 99.5% MVP; Temporal sized for bursty workloads.
- Observability: structured logs with request/workflow IDs; metrics for latency, errors, enqueue rates.
- Soft delete: consistent filtering on deleted_at for tables, views, rows.
- Storage: MinIO with credential rotation and bucket/key-based access; lifecycle policies as needed.

## 11. Success Metrics & Risks
- Metrics: time to first database (<5 minutes from signup); P99 view load latency; workflow success rate; invite acceptance rate; public link usage.
- Risks: complex permission resolution impacting latency—cache principal sets; missing deleted_at filters causing leakage—add guards/tests; workflow fan-out load on Temporal; schema evolution (column type changes) affecting stored data.

## 12. Open Questions / Follow-Ups
- Do we need default permission templates per company (starter roles/groups)?
- Do we need hard-delete tooling for compliance/cleanup?
- Should we support group-level default grants at database creation time?

